response = Map();
info answers;
if(context_id.equals("booking"))
{
	ans1 = answers.get("schedule").get("text");
	if(ans1.containsIgnoreCase("Yeah"))
	{
		response.put("action","context");
		response.put("context_id","datetime");
		questions = Collection();
		question10 = {"name":"datetime","replies":{{"text":"Choose a date and time between 9 to 12pm only."}},"input":{"type":"calendar","time":true,"tz":true,"from":"+1","label":"Schedule appointment","select_label":"Done","to":"+90"}};
		questions.insert(question10);
		response.put("questions",questions);
	}
	else if(ans1.containsIgnoreCase("anytime"))
	{
		response.put("action","context");
		response.put("context_id","rating");
		questions = Collection();
		question1 = {"name":"rating","replies":{{"text":"How would you rate your chat session with our MedStar bot?"}},"input":{"type":"happiness-rating","level":"5"}};
		questions.insert(question1);
		response.put("questions",questions);
		response.put("action","end");
		response.put("replies",{{"text":"Thank you.You will receive an email from our agent regarding your appointment timings. Have a great day!"}});
	}
}
else if(context_id.equals("datetime"))
{
	emailaddr = answers.get("email").get("text");
	sendmail
	[ 
		from : "medstarhospitals@gmail.com"
		to : emailaddr
		subject: "Confirmation mail for the scheduled appointment"
		message : "<div>This is the confirmation mail for your scheduled appointment, Click the confirm button to confirm your appointment.<br></div><div> You are receiving this email since you scheduled an appointment using our Medstar bot in our website 'MedStar Hospitals'. You can reach us @&nbsp;&nbsp;<a target='_blank' href='http://medstar.zohosites.com/'>http://medstar.zohosites.com/</a>&nbsp;<br></div>"
	]
	ans = answers.get("datetime").get("text");
	response.put("action","context");
	response.put("context_id","confirmdatetime");
	question1 = {"name":"confirm","replies":{{"text":"Thank you. We have sent you confirmation mail.Please click the link mentioned in the email to confirm your appointment."}},"input":{"type":"select","options":{"Changetime","Thanks"}}};
	questions = Collection();
	questions.insert(question1);
	response.put("questions",questions);
}
else if(context_id.equals("confirmdatetime"))
{
	ans = answers.get("confirm").get("text");
	if(ans.containsIgnoreCase("Changetime"))
	{
		response.put("action","context");
		response.put("context_id","datetime");
		questions = Collection();
		question1 = {"name":"datetime","replies":{{"text":"Choose a date and time between 9 to 12pm only."}},"input":{"type":"calendar","time":true,"tz":true,"from":"+1","label":"Schedule appointment","select_label":"Done","to":"+90"},"skippable":true};
		questions.insert(question1);
		response.put("questions",questions);
	}
	else if(ans.containsIgnoreCase("Thanks"))
	{
		response.put("action","context");
		response.put("context_id","rating");
		questions = Collection();
		question1 = {"name":"rating","replies":{{"text":"How would you rate your chat session with our MedStar bot?"}},"input":{"type":"happiness-rating","level":"5"}};
		questions.insert(question1);
		response.put("questions",questions);
		response.put("action","end");
		response.put("replies",{{"text":"Have a great day"}});
	}
}
return response;
